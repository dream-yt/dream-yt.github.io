<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		 
			
  
    <meta name="twitter:card" content="summary"/>
    
      <meta name="twitter:image" content="https://dream-yt.github.io/images/avatar.png" />
    
  
  
  <meta name="twitter:title" content="airflow ã® model.py ã‚’èª­ã‚“ã "/>
  <meta name="twitter:description" content="airflow ã®ç®¡ç†ç”»é¢ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç†è§£ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã«è‡ªåˆ†ç”¨ã«ç”¨èªã¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦ãƒ¡ãƒ¢ã—ãŸã€‚ å‰æ airflowã®è¨­å®šã‚„å®Ÿè¡Œå±¥æ­´ã‚’ä¿å­˜ã™ã‚‹ãƒ¡"/>
  
    <meta name="twitter:site" content="@your_twitter_id"/>
  
  
  
  
    <meta name="twitter:creator" content="@site_author"/>
  



		
		<meta name="author" content="site_author">
		<meta name="description" content="Site Description">
		<meta name="generator" content="Hugo 0.51" />
		<title>airflow ã® model.py ã‚’èª­ã‚“ã  &middot; sacre</title>
		<link rel="shortcut icon" href="https://dream-yt.github.io/images/favicon.ico">
		<link rel="stylesheet" href="https://dream-yt.github.io/css/style.css">
		<link rel="stylesheet" href="https://dream-yt.github.io/css/highlight.css">

		
		<link rel="stylesheet" href="https://dream-yt.github.io/css/font-awesome.min.css">
		

		
		<link href="https://dream-yt.github.io/index.xml" rel="alternate" type="application/rss+xml" title="sacre" />
		

		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='https://dream-yt.github.io/'> <span class="arrow">â†</span>Home</a>
	
	<a href='https://dream-yt.github.io/posts'>Archive</a>
	<a href='https://dream-yt.github.io/tags'>Tags</a>
	<a href='https://dream-yt.github.io/about'>About</a>

	

	
	<a class="cta" href="https://dream-yt.github.io/index.xml">Subscribe</a>
	
</nav>


        <section id="wrapper" class="post">
            <article>
                <header>
                    <h1>
                        airflow ã® model.py ã‚’èª­ã‚“ã 
                    </h1>
                    <h2 class="headline">
                    Mar 23, 2021 15:27
                    Â· 1499 words
                    Â· 3 minute read
                      <span class="tags">
                      
                      </span>
                    </h2>
                </header>
                
                  
                    <div id="toc">
                      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#å‰æ">å‰æ</a></li>
<li><a href="#dagbag">DagBag</a></li>
<li><a href="#connection">Connection</a></li>
<li><a href="#taskinstance">TaskInstance</a></li>
<li><a href="#log">Log</a></li>
<li><a href="#dagmodel">DagModel</a></li>
<li><a href="#dag">DAG</a></li>
<li><a href="#knownevent">KnownEvent</a></li>
<li><a href="#xcom">XCom</a></li>
<li><a href="#dagstat">DagStat</a></li>
<li><a href="#dagrun">DagRun</a></li>
</ul></li>
</ul>
</nav>
                    </div>
                  
                
                <section id="post-body">
                    

<p>airflow ã®ç®¡ç†ç”»é¢ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç†è§£ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã«è‡ªåˆ†ç”¨ã«ç”¨èªã¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦ãƒ¡ãƒ¢ã—ãŸã€‚</p>

<h2 id="å‰æ">å‰æ</h2>

<p>airflowã®è¨­å®šã‚„å®Ÿè¡Œå±¥æ­´ã‚’ä¿å­˜ã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯RDBSã§ã‚ã‚Šã€SQLAlchemyã‹ã‚‰åˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã€‚
ãƒ¢ãƒ‡ãƒ«ã«ã¯ç´”ç²‹ãªPythonã®ã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¨ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å…¥ã£ã¦ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’SQLAlchemyã®ORMã¨ã—ã¦æ‰±ã£ã¦ã‚‹ã‚‚ã®ã®2ç¨®é¡ãŒã‚ã‚‹ã€‚</p>

<p>ä»Šå›èª­ã‚“ã pythonã‚³ãƒ¼ãƒ‰ã¯ models.py</p>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<p>ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å…¥ã£ã¦ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯SELECTã—ãŸã‚Šã™ã‚‹ã¨è¦‹ã‚‰ã‚Œã‚‹ã®ã§ã€airflowè‡ªä½“ã®æŒ™å‹•ã§ãƒãƒã£ãŸæ™‚ãªã©ã¯ã“ã®è¾ºã‚Šã®ãƒ¢ãƒ‡ãƒ«å®šç¾©ã‚’ãªã‚“ã¨ãªãçŸ¥ã£ã¦ã„ã‚‹ã¨èª¿æŸ»ãŒãƒ©ã‚¯ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚</p>

<h2 id="dagbag">DagBag</h2>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L144">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<blockquote>
<p>A dagbag is a collection of dags, parsed out of a folder tree and has high level configuration settings, like what database to use as a backend and what executor to use to fire off tasks.</p>
</blockquote>

<ul>
<li>DagBagã¯æ™®é€šã®Pythonã‚¯ãƒ©ã‚¹ã§./dagsã‹ã‚‰DAGã®èª­ã¿è¾¼ã¿å‡¦ç†ã‚’æ‹…å½“ã™ã‚‹</li>
<li>DAGã®ç®¡ç† (dag_idã‹ã‚‰Dagã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å¼•ã„ãŸã‚Š)</li>
</ul>

<h2 id="connection">Connection</h2>

<ul>
<li><a href="https://github.com/apache/incubator-airflow/blob/master/airflow/models.py#L510">airflow/models.py#L510</a></li>
</ul>

<blockquote>
<p>Placeholder to store information about different database instances connection information. The idea here is that scripts use references to database instances (conn_id) instead of hard coding hostname, logins and passwords when using operators or hooks.</p>
</blockquote>

<ul>
<li>Connectionãƒ†ãƒ¼ãƒ–ãƒ«ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹</li>
<li>æ¥ç¶šæƒ…å ±ã®ç®¡ç†ã‚’ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰</li>
<li>MySQLã‚„S3ãªã©ã®å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹æ¯ã«æ¥ç¶šæƒ…å ±ã‚’DBã‚„ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã—ã¦ã„ã‚‹</li>
<li>ä¾‹ãˆã°MySQLãªã‚‰ <code>mysql://foo:bar@hostes.com/report?utf8=1</code> ã¨ã„ã£ãŸæƒ…å ±</li>
</ul>

<h2 id="taskinstance">TaskInstance</h2>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L732">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<blockquote>
<p>Task instances store the state of a task instance. This table is the authority and single source of truth around what tasks have run and the state they are in.</p>
</blockquote>

<ul>
<li>TaskInstanceãƒ†ãƒ¼ãƒ–ãƒ«ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹</li>
<li>Taskã¨ã¯ã€dags.pyã§å®šç¾©ã—ãŸDAGã‚’å®Ÿè¡Œã—ãŸã‚‚ã®

<ul>
<li>DAGã‚¯ãƒ©ã‚¹ã®ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã„ã£ãŸã‚¤ãƒ¡ãƒ¼ã‚¸</li>
<li>ã©ã®TaskãŒã©ã†ã„ã£ãŸçŠ¶æ…‹ã‹ã‚’ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†ã—ã¦ã„ã‚‹</li>
</ul></li>
<li>ãŠãã‚‰ããƒ¦ãƒ¼ã‚¶ãŒä¸€ç•ªèˆˆå‘³ã‚’æŒã¤ã¹ããƒ†ãƒ¼ãƒ–ãƒ«

<ul>
<li>ã©ã®ã‚¿ã‚¹ã‚¯ãŒã©ã“ã¾ã§æˆåŠŸã—ãŸã‹ãªã©ã®æƒ…å ±ãŒå…¥ã£ã¦ã„ã‚‹</li>
</ul></li>
</ul>

<p>ã‚«ãƒ©ãƒ å®šç¾©ã‚‚ã‚¸ãƒ§ãƒ–ãŒå¤±æ•—ã—ãŸã¨ãã«çŸ¥ã‚ŠãŸããªã‚‹ã‚ˆã†ãªé …ç›®ã°ã‹ã‚Š</p>

<pre><code class="language-python">duration = Column(Float)
state = Column(String(20))
try_number = Column(Integer, default=0)
max_tries = Column(Integer)
...
hostname = Column(String(1000))
pid = Column(Integer)
</code></pre>

<p>ãƒ¢ãƒ‡ãƒ«ã¨ã¯é–¢ä¿‚ãªã„ãŒ <code>airflow run</code> ã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã„ã‚‹å‡¦ç†ã¯ã“ã®ã‚¯ãƒ©ã‚¹ã«å®Ÿè£…ã•ã‚Œã¦ã„ãŸã€‚ãªã«ã‹ãƒãƒã£ãŸã¨ãã«å‚è€ƒã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚</p>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L872">https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L872</a></li>
</ul>

<h2 id="log">Log</h2>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L1764">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<blockquote>
<p>Used to actively log events to the database</p>
</blockquote>

<ul>
<li>Logãƒ†ãƒ¼ãƒ–ãƒ«ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹</li>
<li>dag(task)ã®å®Ÿè¡Œå±¥æ­´ã‚’å…¥ã‚Œã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«</li>
</ul>

<h2 id="dagmodel">DagModel</h2>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L2567">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<blockquote>
<p>These items are stored in the database for state related information</p>
</blockquote>

<ul>
<li><code>dags/~.py</code> ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚ŒãŸDAGå®šç¾©ã®æƒ…å ±ã¯ã“ã®ã‚¯ãƒ©ã‚¹ã‹ã‚‰æ‰±ã‚ã‚Œã‚‹</li>
</ul>

<h2 id="dag">DAG</h2>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L2613">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<p>airflowã®å¿ƒè‡“éƒ¨ã¨ãªã‚‹DAGã‚¯ãƒ©ã‚¹ã®å®šç¾©</p>

<blockquote>
<p>A dag (directed acyclic graph) is a collection of tasks with directional dependencies. A dag also has a schedule, a start end an end date (optional). For each schedule, (say daily or hourly), the DAG needs to run each individual tasks as their dependencies are met. Certain tasks have the property of depending on their own past, meaning that they can&rsquo;t run until their previous schedule (and upstream tasks) are completed.</p>
</blockquote>

<p>airflowã§ã¯DAGã‚¯ãƒ©ã‚¹ã«è«¸ã€…è¨­å®šã‚’ã—ã¦ã„ãã“ã¨ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ›¸ãã“ã¨ã«ãªã‚‹ã€‚</p>

<p>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œã‚‹ãŸã‚ã®DAGã‚¯ãƒ©ã‚¹ã‚‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã€‚</p>

<h2 id="knownevent">KnownEvent</h2>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L3608">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<p>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãªã©ã§ã‚‚è¦‹æ…£ã‚Œãªã„åå‰ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚</p>

<ul>
<li>KnownEventType</li>
<li>KnownEvent</li>
</ul>

<p>ãƒ¦ãƒ¼ã‚¶ãŒç®¡ç†ç”»é¢ã‹ã‚‰è¨­å®šã™ã‚‹é¡ã®ã‚‚ã®ãªã®ã‹ãª ğŸ¤”</p>

<h2 id="xcom">XCom</h2>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L3726">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<p>XComã¨ã¯dagé–“ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚’ã™ã‚‹ãŸã‚ã®airflowç‹¬è‡ªã®ä»•çµ„ã¿</p>

<ul>
<li>æ–‡å­—åˆ—æƒ…å ±ãªã‚‰ãªã‚“ã§ã‚‚æ¸¡ã™ã“ã¨ãŒå‡ºæ¥ã‚‹(JSONãªã©ã§æ§‹é€ åŒ–ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚‚æ¸¡ã›ã‚‹)</li>
<li>XComã¯ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚ã‚‹

<ul>
<li><code>value</code>ã¨ã„ã£ãŸã‚«ãƒ©ãƒ ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦ã€XComã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯RDBSã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹</li>
</ul></li>
</ul>

<h2 id="dagstat">DagStat</h2>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L3870">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<p>ã“ã‚“ãªã‚«ãƒ©ãƒ å®šç¾©ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚</p>

<pre><code class="language-python">dag_id = Column(String(ID_LEN), primary_key=True)
state = Column(String(50), primary_key=True)
count = Column(Integer, default=0)
dirty = Column(Boolean, default=False)
</code></pre>

<p>å®Ÿè¡Œä¸­ã®dagã‚’ç›£è¦–ã™ã‚‹ãŸã‚å¾Œè¿°ã®DagRunã¨ä¸€ç·’ã«ä½¿ã†ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¦‹ãˆã‚‹ã€‚</p>

<h2 id="dagrun">DagRun</h2>

<p>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãŒDagã‚’å®Ÿè¡Œã—ãŸã¨ãã«ç”Ÿæˆã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ã®ã“ã¨ã€‚</p>

<ul>
<li><a href="https://github.com/databricks/incubator-airflow/blob/b87d3a49/airflow/models.py#L3987">incubator-airflow/models.py at b87d3a49054f3890cf6714e7c4920973754b810e Â· databricks/incubator-airflow</a></li>
</ul>

<blockquote>
<p>DagRun describes an instance of a Dag. It can be created by the scheduler (for regular runs) or by an external trigger</p>
</blockquote>

<p>ç®¡ç†ç”»é¢ã‹ã‚‰å†å®Ÿè¡Œã™ã‚‹å ´åˆãªã©ã¯ã“ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‚ç…§ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã ã€‚</p>

                </section>
            </article>

            
                <a class="twitter" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fdream-yt.github.io%2fpost%2fairflow-reading-modelpy%2f - airflow%20%e3%81%ae%20model.py%20%e3%82%92%e8%aa%ad%e3%82%93%e3%81%a0 by @your_twitter_id"><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

            

            
                <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'your_disqus_short_name'; 

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

            

            

            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://github.com/dream-yt/sacre">
        <i class="fa fa-github-square"></i>
    </a>
    
    <a class="symbol" href="https://twitter.com/FUTABA_SACRE">
        <i class="fa fa-twitter-square"></i>
    </a>
    


</div>

    
    <p class="small">
    
       Â© Copyright 2022 <i class="fa fa-heart" aria-hidden="true"></i> site_author
    
    </p>
    <p class="small">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/nodejh/hugo-theme-cactus-plus">nodejh</a>
    </p>
</footer>

        </section>

        <script src="https://dream-yt.github.io/js/jquery-3.3.1.min.js"></script>
<script src="https://dream-yt.github.io/js/main.js"></script>
<script src="https://dream-yt.github.io/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  




    </body>
</html>
